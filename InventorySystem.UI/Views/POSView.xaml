<UserControl x:Class="InventorySystem.UI.Views.POSView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="420"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" Margin="0,0,30,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                     Tag="Scan barcode or type name..." 
                     Margin="0,0,0,20" Padding="15" FontSize="16"/>

            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding FilteredProducts}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Command="{Binding DataContext.AddToCartCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                    CommandParameter="{Binding}"
                                    Width="180" Height="160" Margin="0,0,15,15" 
                                    Background="White" Padding="0">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="card" Background="White" CornerRadius="10" BorderBrush="#E2E8F0" BorderThickness="1">
                                            <Grid Margin="15">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <TextBlock Text="{Binding Name}" TextWrapping="Wrap" FontSize="15" FontWeight="Bold" Foreground="#334155" VerticalAlignment="Top"/>

                                                <StackPanel Grid.Row="1">
                                                    <TextBlock Text="{Binding SellingPrice, StringFormat='Rs {0:N0}'}" FontSize="18" FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}"/>
                                                    <TextBlock Text="{Binding Quantity, StringFormat='Stock: {0}'}" FontSize="12" Foreground="#94A3B8" Margin="0,5,0,0"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="card" Property="Background" Value="#F8FAFC"/>
                                                <Setter TargetName="card" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>

        <Border Grid.Column="1" Background="White" CornerRadius="10" Padding="20">
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="20" Opacity="0.08"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Current Order" FontSize="20" FontWeight="Bold" Foreground="#334155" Margin="0,0,0,20"/>

                <DataGrid Grid.Row="1" ItemsSource="{Binding Cart}" 
                          BorderThickness="0" GridLinesVisibility="None" RowHeight="60">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Item" Binding="{Binding Product.Name}" Width="*" IsReadOnly="True" FontWeight="SemiBold"/>

                        <DataGridTemplateColumn Header="Qty" Width="70">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}" 
                                             Padding="5" HorizontalContentAlignment="Center" BorderThickness="1"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="Total" Binding="{Binding TotalPrice, StringFormat=N0}" Width="80" IsReadOnly="True" FontWeight="Bold" Foreground="#334155"/>

                        <DataGridTemplateColumn Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Command="{Binding DataContext.RemoveFromCartCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                            CommandParameter="{Binding}" 
                                            Content="✕" Background="Transparent" Foreground="#EF4444" FontSize="16" Padding="0"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <StackPanel Grid.Row="2" Margin="0,20,0,0">
                    <Separator Margin="0,0,0,20" Background="#E2E8F0"/>
                    <DockPanel Margin="0,0,0,20">
                        <TextBlock Text="Total Amount" FontSize="16" Foreground="#64748B"/>
                        <TextBlock Text="{Binding GrandTotal, StringFormat='Rs {0:N2}'}" HorizontalAlignment="Right" FontSize="28" FontWeight="Bold" Foreground="#334155"/>
                    </DockPanel>

                    <Button Command="{Binding CheckoutCommand}" Content="CHARGE &amp; PRINT" Height="60" FontSize="16"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>